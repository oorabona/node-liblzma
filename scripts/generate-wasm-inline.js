#!/usr/bin/env node
/**
 * Generate the inline WASM base64 module.
 *
 * Reads src/wasm/liblzma.wasm and writes the base64-encoded content
 * into src/wasm/liblzma.inline.ts for the inline entry point.
 *
 * Cross-platform: works on Windows, macOS, and Linux.
 */

import { existsSync, readFileSync, writeFileSync } from 'node:fs';
import { dirname, join } from 'node:path';
import { fileURLToPath } from 'node:url';

const __dirname = dirname(fileURLToPath(import.meta.url));
const projectRoot = join(__dirname, '..');

const wasmFile = join(projectRoot, 'src', 'wasm', 'liblzma.wasm');
const outputFile = join(projectRoot, 'src', 'wasm', 'liblzma.inline.ts');

if (!existsSync(wasmFile)) {
  console.error(`ERROR: WASM binary not found at ${wasmFile}`);
  console.error("Run 'pnpm build:wasm' first.");
  process.exit(1);
}

const wasmBinary = readFileSync(wasmFile);
const base64 = wasmBinary.toString('base64');

const content = `/**
 * Inline WASM binary as base64.
 *
 * This file is generated by \`scripts/generate-wasm-inline.js\`.
 * Do not edit manually.
 *
 * To regenerate: pnpm build:wasm:inline
 */

export const WASM_BASE64 = '${base64}';
`;

writeFileSync(outputFile, content, 'utf-8');

console.log(`Generated ${outputFile}`);
console.log(`  WASM binary: ${wasmBinary.length} bytes`);
console.log(`  Base64 string: ${base64.length} chars`);
